@if (withSearch) {
    <div class="kbq-app-switcher__search-container">
        <kbq-form-field noBorders>
            <i kbq-icon="kbq-magnifying-glass_16" kbqPrefix></i>
            <input kbqInput placeholder="Поиск" [(ngModel)]="searchValue" />
            <kbq-cleaner />
        </kbq-form-field>
    </div>

    <kbq-divider />
}

<div class="kbq-app-switcher__app-container">
    <div class="kbq-app-switcher-group-header">
        <div class="kbq-app-switcher-group-header__text">Название площадки</div>
        <kbq-badge class="kbq-app-switcher-group-header__badge" [compact]="true">Главная</kbq-badge>
    </div>

    <kbq-app-switcher-tree [dataSource]="dataSource" [treeControl]="treeControl" [(ngModel)]="modelValue">
        <kbq-app-switcher-tree-option *kbqTreeNodeDef="let node" kbqAppSwitcherTreeNodePadding>
            <span [innerHTML]="treeControl.getViewValue(node)"></span>
        </kbq-app-switcher-tree-option>

        <kbq-app-switcher-tree-option *kbqTreeNodeDef="let node; when: hasChild" kbqAppSwitcherTreeNodePadding>
            <kbq-tree-node-toggle [node]="node" />

            <span [innerHTML]="treeControl.getViewValue(node)"></span>
        </kbq-app-switcher-tree-option>
    </kbq-app-switcher-tree>
</div>

@if (withSites) {
    <kbq-divider />

    <div class="kbq-app-switcher__sites-container">
        <div class="kbq-app-switcher-group-header">
            <div class="kbq-app-switcher-group-header__text">Другие площадки</div>
        </div>

        <kbq-dropdown #otherSites="kbqDropdown">
            <div kbqDropdownStaticContent class="kbq-app-switcher-sites" (mouseleave)="otherSites.close()">
                @for (site of sites; track site) {
                    <a href=""
                        kbq-dropdown-item
                        [kbqDropdownTriggerFor]="dropdownWithSelectedSite"
                        [class.kbq-app-switcher__sites_main]="site.main"
                        (mouseenter)="activeSite = site"
                    >
                        {{ site.name }}
                        @if (site.main) {
                            <kbq-badge [compact]="true">Главная</kbq-badge>
                        }
                    </a>
                }
            </div>
        </kbq-dropdown>
    </div>
}

<kbq-dropdown #dropdownWithSelectedSite="kbqDropdown" [class]="'kbq-app-switcher-sites'">
    @for (app of activeSite?.apps; track app) {
        @if (app.apps) {
            <a
                href=""
                kbq-dropdown-item
                [kbqDropdownTriggerFor]="dropdownWithGroupedApps"
                (mouseenter)="activeApp = app"
            >
                {{ app.name }}
            </a>
        } @else {
            <a href="" kbq-dropdown-item>{{ app.name }}</a>
        }
    }
</kbq-dropdown>

<kbq-dropdown #dropdownWithGroupedApps="kbqDropdown" [class]="'kbq-app-switcher-sites'">
    @for (app of activeApp?.apps; track app) {
        <a href="" kbq-dropdown-item>{{ app.name }}</a>
    }
</kbq-dropdown>
