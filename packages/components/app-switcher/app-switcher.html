@if (withSearch) {
    <div class="kbq-app-switcher__search-container" (mouseenter)="otherSites.close()">
        <kbq-form-field noBorders>
            <i kbq-icon="kbq-magnifying-glass_16" kbqPrefix></i>
            <input kbqInput placeholder="Поиск" [(ngModel)]="searchValue" />
            <kbq-cleaner />
        </kbq-form-field>
    </div>

    <kbq-divider />
}

<div class="kbq-app-switcher__app-container" (mouseenter)="otherSites.close()">
    <div class="kbq-app-switcher-group-header">
        <div class="kbq-app-switcher-group-header__text">Название площадки</div>
        <kbq-badge class="kbq-app-switcher-group-header__badge" [compact]="true">Главная</kbq-badge>
    </div>

    <kbq-app-switcher-tree [dataSource]="dataSource" [treeControl]="treeControl" [(ngModel)]="modelValue">
        <kbq-app-switcher-tree-option *kbqTreeNodeDef="let node" kbqAppSwitcherTreeNodePadding>
            <span [innerHTML]="treeControl.getViewValue(node)"></span>
        </kbq-app-switcher-tree-option>

        <kbq-app-switcher-tree-option *kbqTreeNodeDef="let node; when: hasChild" kbqAppSwitcherTreeNodePadding>
            <kbq-tree-node-toggle [node]="node" />

            <span [innerHTML]="treeControl.getViewValue(node)"></span>
        </kbq-app-switcher-tree-option>
    </kbq-app-switcher-tree>
</div>

@if (withSites) {
    <kbq-divider />

    <div class="kbq-app-switcher__sites-container">
        <div class="kbq-app-switcher-group-header">
            <div class="kbq-app-switcher-group-header__text">Другие площадки</div>
        </div>

        <kbq-dropdown #otherSites="kbqDropdown">
            <div kbqDropdownStaticContent class="kbq-app-switcher-sites">
                @for (site of sites; track site) {
                    <a
                        href=""
                        [kbq-app-switcher-dropdown-site]="site"
                        [kbqDropdownTriggerFor]="dropdownWithSelectedSite"
                        [offsetX]="0"
                        [class.kbq-app-switcher__sites_main]="site.main"
                        (mouseenter)="activeSite = site"
                    ></a>
                }
            </div>
        </kbq-dropdown>
    </div>

    <kbq-dropdown #dropdownWithSelectedSite="kbqDropdown" [class]="'kbq-app-switcher-sites'">
        @for (app of activeSite?.apps; track app) {
            @if (app.apps) {
                <a
                    #dropdownWithGroupedAppsTrigger="kbqDropdownTrigger"
                    href=""
                    [kbq-app-switcher-dropdown-app]="app"
                    [kbqDropdownTriggerFor]="dropdownWithGroupedApps"
                    [offsetX]="0"
                    [class.kbq-pressed]="dropdownWithGroupedAppsTrigger.opened"
                    (mouseenter)="activeApp = app"
                ></a>
            } @else {
                <a href="" [kbq-app-switcher-dropdown-app]="app"></a>
            }
        }
    </kbq-dropdown>

    <kbq-dropdown #dropdownWithGroupedApps="kbqDropdown" [class]="'kbq-app-switcher-sites'">
        @for (app of activeApp?.apps; track app) {
            <a href="" [kbq-app-switcher-dropdown-app]="app"></a>
        }
    </kbq-dropdown>
}
