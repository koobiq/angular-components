<button
    #popover="kbqPopover"
    kbq-button
    kbqPopover
    [disabled]="data.disabled"
    [kbq-pipe-states]="data"
    [kbqPopoverArrow]="false"
    [kbqPopoverClass]="'kbq-pipe-date__popover'"
    [kbqPopoverContent]="content"
    [kbqPopoverOffset]="0"
    [kbqPopoverPlacement]="placements.BottomLeft"
>
    <span class="kbq-pipe__name">{{ data.name }}</span>
    <span class="kbq-pipe__value">{{ data.value?.name }}</span>
</button>

@if (!data.required && !isEmpty) {
    <button
        kbq-button
        class="kbq-pipe__delete"
        [disabled]="data.disabled"
        [kbq-pipe-states]="data"
        (click)="onDeleteOrClear()"
    >
        <i kbq-icon="kbq-xmark-s_16"></i>
    </button>
}

<ng-template #content>
    @if (list) {
        <div class="kbq-date-list">
            <kbq-list-selection>
                <kbq-list-option [value]="0" (click)="list = false">
                    Произвольный период
                    <i class="kbq kbq-icon kbq-chevron-right_16 kbq-contrast-fade"></i>
                </kbq-list-option>

                @for (item of values; track item) {
                    <kbq-list-option [value]="item" (click)="onSelect(item)">{{ item.name }}</kbq-list-option>
                }
            </kbq-list-selection>
        </div>
    } @else {
        <div class="kbq-date-period kbq-datepicker__content" (keydown)="onKeydown($event)">
            <div class="kbq-date-period__header">
                <button kbq-button [color]="colors.Theme" [kbqStyle]="styles.Transparent" (click)="list = true">
                    <i kbq-icon="kbq-chevron-left_16"></i>
                    Назад к выбору периода
                </button>
            </div>

            <kbq-divider />

            <div class="kbq-date-period__content kbq-form-horizontal">
                <div class="kbq-date-period__content-header">Произвольный период</div>
                <div class="kbq-form__row">
                    <label class="kbq-form__label flex-10">c</label>

                    <kbq-form-field #startDateField class="kbq-date-period__date kbq-form__control flex-45">
                        <input [kbqCalendar]="startDateCalendar" [ngModel]="startDate" />
                        <i kbq-icon="kbq-calendar-o_16" kbqSuffix></i>
                    </kbq-form-field>

                    <kbq-form-field class="kbq-date-period__time kbq-form__control flex-45">
                        <i kbq-icon="kbq-clock_16" kbqPrefix></i>
                        <input kbqTimepicker [ngModel]="startDate" />
                    </kbq-form-field>
                </div>

                <kbq-calendar #startDateCalendar [class.kbq-calendar_hidden]="!startDateField.hasFocus" />

                <div class="kbq-form__row">
                    <label class="kbq-form__label flex-10">по</label>

                    <kbq-form-field #endDateField class="kbq-date-period__date kbq-form__control flex-45">
                        <input [kbqCalendar]="endDateCalendar" [ngModel]="endDate" />
                        <i kbq-icon="kbq-calendar-o_16" kbqSuffix></i>
                        <kbq-datepicker #datepicker />
                    </kbq-form-field>

                    <kbq-form-field class="kbq-date-period__time kbq-form__control flex-45">
                        <i kbq-icon="kbq-clock_16" kbqPrefix></i>
                        <input kbqTimepicker [ngModel]="endDate" />
                    </kbq-form-field>
                </div>

                <kbq-calendar #endDateCalendar [class.kbq-calendar_hidden]="!endDateField.hasFocus" />
            </div>

            <div class="kbq-date-period__footer">
                <button kbq-button [color]="'theme'" [disabled]="isEmpty" [kbqStyle]="'transparent'">
                    <span>Применить</span>
                    &nbsp;
                    <span class="kbq-button_hot-key">Ctrl + Enter</span>
                </button>
            </div>
        </div>
    }
</ng-template>
