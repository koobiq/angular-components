<div
    class="kbq-popover"
    [cdkTrapFocus]="isTrapFocus"
    [cdkTrapFocusAutoCapture]="isTrapFocus"
    [ngClass]="classMap"
    (@state.done)="animationDone($event)"
    (@state.start)="animationStart()"
    [@state]="visibility"
>
    <div
        class="kbq-popover__container"
        [class.kbq-popover__container_with-footer]="footer"
        [class.kbq-popover__container_with-header]="header"
    >
        <div
            *ngIf="header"
            class="kbq-popover__header"
            [class.kbq-popover__header_top-overflow]="isContentTopOverflow"
            [class.kbq-popover__header_with-close-button]="hasCloseButton"
        >
            <ng-container
                *ngIf="isTemplateRef(header)"
                [ngTemplateOutlet]="$any(header)"
            />

            <ng-container *ngIf="!isTemplateRef(header)">
                <div class="kbq-popover__header-text">{{ header }}</div>
            </ng-container>
        </div>

        <div
            *ngIf="content"
            #popoverContent
            class="kbq-popover__content kbq-scrollbar"
            (cdkObserveContent)="onContentChange()"
        >
            <div
                *ngIf="hasCloseButton && !header"
                class="kbq-popover__close-container"
            >
                <ng-container *ngTemplateOutlet="closeButton" />
            </div>

            <ng-container
                *ngIf="isTemplateRef(content)"
                [ngTemplateOutlet]="$any(content)"
            />

            <ng-container *ngIf="!isTemplateRef(content)">
                <div>{{ content }}</div>
            </ng-container>
        </div>

        <div
            *ngIf="footer"
            class="kbq-popover__footer"
            [class.kbq-popover__footer_bottom-overflow]="isContentBottomOverflow"
        >
            <ng-container
                *ngIf="isTemplateRef(footer)"
                [ngTemplateOutlet]="$any(footer)"
            />

            <ng-container *ngIf="!isTemplateRef(footer)">
                <div>{{ footer }}</div>
            </ng-container>
        </div>
    </div>

    <div
        *ngIf="hasCloseButton && header"
        class="kbq-popover__close-container"
    >
        <ng-container *ngTemplateOutlet="closeButton" />
    </div>

    <ng-template #closeButton>
        <div class="kbq-popover__close">
            <button
                kbq-button
                class="kbq-button_transparent"
                [color]="componentColors.Contrast"
                (click)="hide(0)"
            >
                <i
                    kbq-icon="mc-close-L_16"
                    [color]="componentColors.Contrast"
                ></i>
            </button>
        </div>
    </ng-template>

    <div class="kbq-popover__arrow"></div>
</div>
