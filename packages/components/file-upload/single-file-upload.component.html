<div
    kbqFileDrop
    class="kbq-file-upload"
    [class.kbq-disabled]="disabled"
    [class.kbq-error]="invalid"
    (filesDropped)="onFileDropped($event)"
>
    @if (!file) {
        <div class="kbq-file-dropzone">
            <i kbq-icon="kbq-cloud-arrow-up-o_24" class="kbq-file-dropzone__icon"></i>
            @let text = fileUploadContext.onlyDirectory() ? config.captionText : config.captionTextWithFolder;
            <kbq-dynamic-translation [text]="text">
                <label
                    *kbqDynamicTranslationSlot="'browseLink'; let context"
                    kbq-link
                    pseudo
                    kbqFileLoader
                    [onlyDirectory]="null"
                    [accept]="acceptedFiles"
                    [disabled]="disabled"
                    [for]="fileUploadContext.id() || inputId"
                    [tabIndex]="-1"
                    [multiple]="true"
                    (fileChange)="onFileSelectedViaClick($event)"
                >
                    {{ context }}
                </label>

                <label
                    *kbqDynamicTranslationSlot="'browseLinkForFolder'; let context"
                    kbq-link
                    pseudo
                    kbqFileLoader
                    [onlyDirectory]="true"
                    [disabled]="disabled"
                    [tabIndex]="-1"
                    (fileChange)="onFileSelectedViaClick($event)"
                >
                    {{ context }}
                </label>
            </kbq-dynamic-translation>
        </div>
    } @else {
        @if (file) {
            <div class="kbq-file-item">
                <div class="kbq-file-item__text-wrapper">
                    @if ({ loading: file.loading | async, progress: file.progress | async }; as asyncData) {
                        @if (!asyncData.loading) {
                            <ng-content select="[kbq-icon]" />
                        }
                        @if (asyncData.loading) {
                            <kbq-progress-spinner [mode]="progressMode" [value]="asyncData.progress || 0" />
                        }
                    }
                    <div class="kbq-file-item__text" [kbqEllipsisCenter]="file.file.name" [minVisibleLength]="10"></div>
                </div>
                @if (showFileSize) {
                    <div class="kbq-file-item__size">
                        {{ file.file.size | kbqDataSize }}
                    </div>
                }
                <i
                    kbq-icon-button="kbq-circle-xmark_16"
                    class="kbq-file-upload__action"
                    [disabled]="disabled"
                    (click)="deleteItem($event, 'program')"
                    (keydown.backspace)="deleteItem()"
                    (keydown.delete)="deleteItem()"
                ></i>
            </div>
        }
    }
</div>

@if (hasHint) {
    <div class="kbq-file-upload__hint">
        <ng-content select="kbq-hint" />
    </div>
}
