<div
    kbqFileDrop
    class="kbq-file-upload"
    [class.kbq-disabled]="disabled"
    [class.kbq-error]="invalid"
    [disabled]="fullScreenDropZone()"
    (filesDropped)="onFileDropped($event)"
>
    @if (!file) {
        <div class="kbq-file-dropzone">
            <i kbq-icon="kbq-arrow-up-from-bracket_16" class="kbq-file-upload__dropzone-icon"></i>
            <span class="kbq-file-upload__dropzone-caption">
                <ng-container *ngTemplateOutlet="captionText; context: captionContext()" />
            </span>
        </div>
    } @else {
        @if (file) {
            <div class="kbq-file-item">
                <div class="kbq-file-item__text-wrapper">
                    @if ({ loading: file.loading | async, progress: file.progress | async }; as asyncData) {
                        @if (!asyncData.loading) {
                            <ng-content select="[kbq-icon]" />
                        }
                        @if (asyncData.loading) {
                            <kbq-progress-spinner [mode]="progressMode" [value]="asyncData.progress || 0" />
                        }
                    }
                    <div class="kbq-file-item__text" [kbqEllipsisCenter]="file.file.name" [minVisibleLength]="10"></div>
                </div>
                @if (showFileSize) {
                    <div class="kbq-file-item__size">
                        {{ file.file.size | kbqDataSize }}
                    </div>
                }
            </div>
            <i
                kbq-icon-button="kbq-circle-xmark_16"
                class="kbq-file-upload__action"
                [color]="invalid ? 'error' : 'contrast-fade'"
                [disabled]="disabled"
                (click)="deleteItem($event, 'program')"
                (keydown.backspace)="deleteItem()"
                (keydown.delete)="deleteItem()"
            ></i>
        }
    }
</div>

@if (hasHint) {
    <div class="kbq-file-upload__hint">
        <ng-content select="kbq-hint" />
    </div>
}

<ng-template
    #captionText
    let-captionText="captionText"
    let-browseLink="browseLink"
    let-captionTextSeparator="captionTextSeparator"
    let-browseLinkFolder="browseLinkFolder"
>
    @if (captionText) {
        {{ captionText }}
    }
    @if (browseLink) {
        <label
            kbq-link
            pseudo
            kbqFileLoader
            [onlyDirectory]="null"
            [accept]="acceptedFiles"
            [disabled]="disabled"
            [for]="fileUploadContext.id() || inputId"
            [tabIndex]="-1"
            [multiple]="true"
            (fileChange)="onFileSelectedViaClick($event)"
        >
            {{ browseLink }}
        </label>
    }
    @if (captionTextSeparator) {
        {{ captionTextSeparator }}
    }
    @if (browseLinkFolder) {
        <label
            kbq-link
            pseudo
            kbqFileLoader
            [onlyDirectory]="true"
            [disabled]="disabled"
            [tabIndex]="-1"
            (fileChange)="onFileSelectedViaClick($event)"
        >
            {{ browseLinkFolder }}
        </label>
    }
</ng-template>
