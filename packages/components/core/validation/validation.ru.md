<div class="kbq-callout kbq-callout_warning">
<div class="kbq-callout__header">Обратите внимание</div>
<div class="kbq-callout__content kbq-docs-element-last-child-margin-bottom-0">

К элементам формы применяется [`KbqValidateDirective`](https://github.com/koobiq/angular-components/blob/main/packages/components/form-field/validate.directive.ts), которая подменяет методы формы (`Validators`, `onSubmit`), что может привести к _"непредсказуемому"_ поведению.

</div>
</div>

### Отключение KbqValidateDirective

```ts
import { kbqDisableLegacyValidationDirectiveProvider } from '@koobiq/components/core';

@NgModule({
    providers: [kbqDisableLegacyValidationDirectiveProvider()]
})
```

---

### Кратко

- Кнопка отправки никогда не блокируется
- О вводе недопустимого символа сообщаем по мере ввода
- Показываем сообщение об ошибке при смене фокуса
- На пустые обязательные поля не ругаемся при потере фокуса
- Поле в состоянии ошибки валидируется по мере ввода

### Открытие формы

Фокус расположен в первом поле формы. Незаполненные поля не подсвечиваются красным с ошибкой. Исключением может быть сохраненный черновик с уже показанными ошибками, который открыли, чтобы продолжить заполнение.

<!-- example(validation-on-open) -->

### Обязательные поля

Обязательные поля не отмечаются, если их в форме большинство. К дополнительным для заполнения полям можно добавить пометку или плейсхолдер «Необязательно». Еще лучше объяснить, чем поможет пользователю заполнение этой информации.

<!-- example(validation-optional-label) -->

Некоторые поля можно не отмечать необязательными, если их дополнительная роль понятна. Например, «Описание».

Если в форме большинство полей необязательные, то редкие обязательные нужно пометить. Можно добавить красную звездочку после названия или серую пометку «Обязательно» под поле. В одной форме не используйте разные способы обозначения

<!-- example(validation-required-label) -->

### Когда проверять на ошибки

Есть три способа проверки на ошибки:

1. Проверка по мере ввода
2. При выходе из поля
3. После отправки формы

#### Проверка по мере ввода

Используется для проверки на допустимые символы. В момент ввода фильтруем недопустимый символ и показываем ошибку в тултипе около каретки ввода. Сообщение пропадает при вводе корректного символа или потере фокуса.

<!-- example(validation-on-type) -->

#### При выходе из поля

Если требования к значениям в поле относительно сложные (например, это IP-адрес или адрес эл. почты), то поле не должно получать состояние ошибки во время ввода, чтобы не сбивать пользователя с толку. Валидация в таких случаях выполняется по потере фокуса: поле оформляется невалидным и показывается сообщение об ошибке под ним.

<!-- example(validation-on-blur) -->

Пустое поле при потере фокуса не валидируется.

Валидация при вводе работает в уже отмеченном ошибкой поле. Поле возвращается к нормальному состоянию после изменения значения, сообщение об ошибке пропадет.

Невалидное поле сохраняет оформление, если из него вышли, но ошибку не исправили.

<!-- example(validation-on-blur-filled) -->

#### После отправки формы

По умолчанию ошибки показываются только для **невалидных** (некорректно заполненных) полей после взаимодействия пользователя.
Чтобы отображать ошибки сразу после отправки формы, используйте `ShowOnFormSubmitErrorStateMatcher` — реализацию [ErrorStateMatcher](https://github.com/koobiq/angular-components/blob/main/packages/components/core/error/error-state-matcher.ts).

Такая валидация используется для проверки пустых обязательных полей и тех, которые нельзя проверить на клиенте.

Кнопка отправки не блокируется в пустой форме или с невалидными полями. По клику на кнопку происходит валидация и отправка формы: кнопка принимает состояние **Progress** в момент отправки. Также в момент отправки поверх формы можно показать [Loader Overlay](/ru/components/loader-overlay).

При неудачной валидации фокус встает в первое поле с ошибкой. Если ошибка отправки не относится к конкретному полю, то показываем такое сообщение алертом над формой и ставим на него фокус. Так пользователь точно увидит алерт, даже если верхняя часть формы оказалась вне видимой области.

Если при повторной отправке формы ошибка не исправлена и сообщение в алерте по-прежнему актуально, то не надо скрывать и снова показывать его. Алерт должен плавно стать прозрачными и снова проявится, а фокус снова окажется на сообщении.

<!-- example(validation-on-submit) -->

### Сообщение об ошибке

#### Сообщение для отдельного поля

Сообщение об ошибке, которое относится к отдельному полю показываем под ним, но располагаем его перед текстом подсказки. Если сообщение об ошибке повторяет подсказку, то можно заменить одно другим.

<!-- example(validation-message-for-specific-field) -->

Допустимо не писать текст ошибки о том, что необходимо заполнить обязательные поля, а лишь оформить их невалидными.

<!-- example(validation-no-message) -->

#### Общее сообщение

Общую для формы ошибку показываем алертом над первым полем и перемещаем фокус на сообщение. Алерт располагается выше, чем информационный блок, который часто располагается над полями.

В этом примере сообщение будет показано после нажатия по кнопку отправки. При управлении мышкой достаточно пролистать до алерта, а рамку фокуса показывать не надо. Если кнопка была активирована с клавиатуры, то показываем на алерте видимую рамку фокуса.

<!-- example(validation-message-global) -->

#### Обязательные поля на выбор

В некоторых формах требуется заполнить хотя бы одно из обязательных полей. В этом случае после отправки формы поля не оформляются невалидными. Сообщение об ошибке показывается алертом над формой. В нем можно перечислить невалидные поля и вставить псевдоссылки, которые будут перемещать фокус в соответствующий элемент управления.

<!-- example(validation-message-global-with-links) -->
