В этом руководстве дается подробное описание подключения и настройки тем в Angular приложениях с использованием дизайн-системы Koobiq. В нем рассказывается о подключении готовых тем, кастомизации стандартных тем с помощью дизайн-токенов и расширенной кастомизации с использованием кастомных токенов и переменных CSS.

Термины:
- [Миксины](https://sass-lang.com/documentation/at-rules/mixin/) - повторяющиеся участки кода в Sass.

### Простое подключение темы
Для быстрого запуска вы можете подключить готовую тему из Koobiq. Данный подход позволит использовать стили по-умолчанию для компонентов дизайн системы Koobiq, а также использовать одну из стандартных тем - светлую или темную.

#### Подготовка
Установите пакет дизайн системы Koobiq. Подробнее про установку [тут](./installation.md).

#### Применение темы

1. Импорт готовой темы: Включите нужную тему, используя  команду @use, в свой основной файл стиля (например, styles.scss).:

#### Пример на Stackblitz
Пример простого подключения можно найти [тут](https://stackblitz.com/edit/vaffk1?file=src%2Fstyles.scss)

### Кастомизация: Уровень 1
В рамках данного раздела дается описание по настройке переключения тем и кастомизации новых компонентов с помощью имеющихся токенов в дизайн системе. Koobiq позволяет подключать стандартные темы оформления (светлую и темную) с помощью дизайн-токенов. Эти токены представляют элементы дизайна, такие как цвета, шрифты и размеры, что позволяет согласованно настраивать переключение тем в вашем приложении.

#### Подключение стандартных тем
В этом разделе вы узнаете, как подключить светлую и темную темы, подключить стили Koobiq, включив их в свой основной файл стилей, и настроить переключение тем.

##### Описание процесса
Процесс настройки состоит из 4 основных этапов:
- 1 Подключение основных стилей светлой и темной темы, в рамках которой создается отдельная директория с файлами для каждого типа токенов соответственно - цвета тем и типографика.
- 2 Подключение стилей Koobiq - создаётся вспомогательный scss-файл для подключения в основной файл стилей. В данном вспомогательном файле:
   - 2.1 объявляются и применяются необходимые инструменты из пакета @koobiq/components - цвета, базовые визуальные элементы, темизация стандартных компонентов Koobiq
   - 2.2 Создаются миксины для подключения в основном файле - миксин базовой типографики и миксин для подключения цветов. Таким образом, структура вспомогательного файла стилей Koobiq выглядит так:
```
_theme.kbq.scss
  ├── объявление инструментов стилей из пакета @koobiq/components
  ├── применение инструментов из пакета @koobiq/components
  ├── миксин базовой типографики (@mixin app-typography)
  └── миксин для подключения цветов и темизации цветов (@mixin app-theme)
```
- 3 Подключение вспомогательного файла стилей в основной файл стилей - на данном этапе необходимо подключить файлы, где подключили темы на этапе 1 и стили Koobiq на этапе 2. Затем в рамках базового CSS-селектора `.kbq` задается подключение типографики и настраиваются стили для переключения тем.
- 4 Настройка переключения тем - данный этап подразумевает реализацию логики подстановки CSS-классов указанной темы. В рамках данного гайда используется сервис `KbqThemeService` из пакета `@koobiq/components/core` для управления переключением тем. CSS-селекторы для темной и светлой темы должны совпадать со значениями тем в инструменте для переключения тем. Каждый CSS-класс темы инкапсулирует настроенные цвета для всех стандартных компонентов Koobiq.

##### Подключение основных стилей светлой и темной темы
1. Создайте директории тем: организуйте свои стили тем, добавив каталог для светлой и темной темы в каталоге стилей вашего проекта:
2. Импортируйте стили тем: Импортируйте стили тем из каталога в свой основной файл стилей (например, styles.scss).:

##### Подключение стилей Koobiq
1. Импортируйте стили Koobiq: В свой основной файл стилей импортируйте необходимые стили Koobiq

##### Включение стилей Koobiq в основной файл стилей

1. Включите основные стили: В свой основной файл стилей добавьте импортированные стили светлой и темной темы и основные стили Koobiq:

##### Настройка переключения тем
Контекст: Здесь стоит сказать про то, что такое переключение тем и как оно работает
Переключение темы представляет собой логику подстановки CSS-классов с указанной темой, которые инкапсулирует настроенные цвета для всех компонентов.

1. В рамках данного гайда используется сервис `KbqThemeService` для управления переключением тем

// TODO: Добавить пример кода

// TODO: добавить логику переключения в зависимости от операционной системы

##### Пример на StackBlitz

Пример переключения стандартных тем [тут](https://stackblitz.com/edit/vaffk1?file=src%2Fstyles.scss)

#### Кастомизация Компонентов с помощью Дизайн Токенов
В этом разделе вы узнаете, как создать настраиваемый компонент с использованием дизайн токенов Koobiq.

##### Подготовка
Для возможности кастомизации компонентов с помощью дизайн токенов необходимо настроить [подключение стандартных тем](#подключение-стандартных-тем) без логики переключения тем.

##### Описание процесса
Процесс кастомизации компонента с помощью дизайн-токенов Koobiq состоит из 2 основных этапов:
1. Создание и настройка компонента. Здесь создаётся angular компонент по умолчанию и scss-файл темизации. Обычно, имя файла темизации задаётся в формате `_<component-name>-theme.scss`. В данном файле темизации создаётся 2 миксина - для подключения цветов из темы и для стилизации типографики. Основной файл стилей используется для кастомизации геометрии - ширина, высота, скругления и т.д.
2. Импорт файла темизации кастомного компонента в основной файл стилей - подключение миксина подключения цветов и миксина стилизации типографики в миксин темизации цветов и в миксин базовой типографики соответственно.

##### Создание компонента и добавление дизайн-токенов

- Создайте файл Mixin: В каталоге вашей темы (например, src/styles/out-of-the-box-theme) создайте новый SCSS-файл (например, _theme.kbq.scss), в котором будут размещены Mixin файлы для настройки вашей темы.

- Структура компонента: Создайте новый каталог компонентов со следующей структурой:
```
customized-component
  ├── _customized-component-theme.scss (Theme & Typography mixins)
  ├── customized-component.component.html (Component template)
  ├── customized-component.component.scss (Component styles)
  ├── customized-component.component.spec.ts (Component tests)
  └── customized-component.component.ts (Component logic)
```

- Импортируйте миксины дизайн-токенов: В _customized-component-theme.scss импортируйте два миксина (названия может быть любым):
1. для стилей цветов компонента, которые берутся из текущей темы
2. для типографики компонета

```scss
@use '@koobiq/components/core/styles/typography';

@mixin kbq-customized-component-theme($theme) {
  // ... your component's color styles using tokens from $theme
}

@mixin kbq-customized-component-typography($config) {
  // ... your component's typography styles using $config
}
```
- Определите стили компонента: В `_customized-component-theme.scss` определите стили, используя импортированные миксины и токены темы

##### Импорт стилей кастомного компонента в основной файл стилей

- Подключите миксины компонента к миксину основной темы:
   В вашем файле миксина основной темы (_theme.kb.scss) импортируйте и используйте созданные миксины компонентоа:

##### Пример на StackBlitz
Пример кастомизации компонентов с помощью дизайн-токенов [тут](https://stackblitz.com/edit/vaffk1?file=src%2Fstyles.scss)

### Кастомизация: Уровень 2
В этом руководстве вы познакомитесь с процессом создания пользовательских дизайн-токенов и управления ими с помощью [Style-Dictionary](http://amzn.github.io/styledictionary/#/architecture). Пользовательские дизайн-токены позволяют вам переопределять свойства, используемые в дизайн-системе, делая их масштабируемым и персонализированными. Создание пользовательских дизайн-токенов аналогично созданию пользовательских тем.

#### Подготовка
Для создания кастомизированных токенов, необходимо добавить style-dictionary в зависимости:

npm:
```shell
npm install --save-dev style-dictionary
```

yarn:
```shell
yarn add --dev style-dictionary
```

#### Описание процесса
Процесс создания пользовательских тем состоит из 2 этапов:

- 1 Создание кастомных токенов
  - 1.1 Создание директории. Данный этап включает в себя создание директории рядом с директорией стандартной темы. Далее добавляем в эту директорию файлы с расширением .json5, чтобы задать значения, которые хотим настроить. Если для пользовательской темы необходимо переопределить некоторые значения стандартных тем, то наименования этих файлов должны совпадать с названиями из пакета `@koobiq/design-tokens`.
  - 1.2 Создание скрипта генерации токенов. Данный скрипт принимает на вход пути стандартных свойств дизайн-токенов, стандартных стилей компонентов, а также путь до файлов с переопределенными пользовательскими свойстами. Таким образом, скрипт расширяет и меняет значение базовых токенов, складывая их в директорию, указанную в `outputPath`.
- 2 Применение кастомных токенов - данный этап аналогичен [подключению стандартных тем](#подключение-стандартных-тем), только токены здесь берутся по локальным путям и меняется имя темы. Если для светлой/темной темы необходимо применение стандартного и пользовательского отображения, то можно настроить это путём уточнения CSS-класса.

#### Создание кастомных токенов
Чтобы создать пользовательские токены, вам необходимо подготовить директорию для новой темы. Вот как вы можете его настроить:

1. Создайте каталог темы:

Перейдите в каталог src/styles вашего проекта и создайте новый каталог с именем customized-theme.

2. Добавьте файлы свойств:
   Внутри каталога customized-theme создайте другой каталог с именем properties.

В каталоге свойств добавьте файлы с расширением .json5, чтобы задать значения, которые вы хотите настроить. Вот несколько примеров того, что могут содержать эти файлы:

| property            | description                                               |
|---------------------|-----------------------------------------------------------|
| colors.json5        | Именованные цвета для основных состояний и главных цветов |
| globals.json5       | Размеры, общие цвета                                      |
| md-typography.json5 | Типографика для маркдауна                                 |
| typography.json5    | Общая типографика                                         |
| palette.json5       | Палитра цветов со значениями                              |

#### Создание скрипта генерации токенов
To automate the process of generating tokens, create a script in your project. This script will handle the expansion and modification of base tokens.

Чтобы автоматизировать процесс генерации токенов, добавьте скрипт в своем проекте. Этот скрипт будет отвечат за расширение и модификацию базовых токенов.

1. Создайте файл скрипта:
- В вашем проекте перейдите в каталог scripts и создайте новый файл с именем build-tokens.js.

#### Применение кастомных токенов
To apply the new theme, you can connect it in the same way as the basic light and dark themes.
Чтобы применить новую тему, вы можете подключить ее таким же образом, как и основные светлую/темные темы.

Структура каталогов для нескольких тем
Чтобы управлять несколькими наборами дизайн-токенов, организуйте свой каталог стилей следующим образом:
```
└─ styles
    └─ koobiq ·························· Directory with sets
        ├─ customized-theme ············ A generated set of custom tokens with imported tokens
        ├─ out-of-the-box-theme ········ Set with default tokens from the Koobiq package
        ├─ _index.scss
        └─ _theme.kbq.scss
```

#### Пример на Stackblitz
Пример применения пользовательских тем можно найти [тут](https://stackblitz.com/edit/vaffk1?file=src%2Fstyles.scss)

### Использование CSS-переменных
В рамках дизайн-системы Koobiq помимо использования SCSS переменных, возможно использование [CSS переменных.](https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties)

#### Описание процесса
Процесс применения CSS-переменных состоит из 4 этапов:

- 1 Переместите файл с CSS-переменных в вашу директорию со стилями: `css-tokens.css` из `@koobiq/design-tokens/web` например, в `src/styles`
- 2 Подключите к основной HTML-странице CSS-файл: `<link rel="stylesheet" href="styles/css-tokens.css">`
- 3 Для приложения с Angular CLI (опционально) добавьте объявление стилей: в раздел `architect.build.options.styles` путь до стилей - `src/styles/css-tokens.css`
- 4 Используйте CSS-переменные вместо объявленных ранее токенов.

#### Пример на Stackblitz
Пример применения CSS-переменных можно найти [тут](https://stackblitz.com/edit/vaffk1?file=src%2Fstyles.scss)
